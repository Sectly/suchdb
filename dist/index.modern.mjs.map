{"version":3,"file":"index.modern.mjs","sources":["../src/index.js"],"sourcesContent":["/**\r\n* @sectly-studios/suchdb | 1.0.16 (Sun Dec 10 2023)\r\n* An simple, dependency free, require &amp; go node.js and browser database\r\n* Auhtor: Sectly (Sectly@sectly.online)\r\n* Licence: MPL-2.0, This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.\r\n* NPM: https://www.npmjs.com/package/@sectly-studios/suchdb\r\n*/\r\n\r\n// Source:\r\n(function (exports) {\r\n  'use strict'\r\n\r\n  function SuchDBMaster (options, isNode) {\r\n    const version = 'V1.0.16'\r\n    const suchdb = {}\r\n    let events = []\r\n\r\n    options = options || {}\r\n    isNode = isNode || false\r\n\r\n    // Core Functions:\r\n\r\n    function nodeify (defaultvalue, nodevalue) {\r\n      if (isNode) {\r\n        return nodevalue || null\r\n      } else {\r\n        return defaultvalue || null\r\n      }\r\n    }\r\n\r\n    function getoption (data, defaultvalue) {\r\n      const name = data.name || false\r\n      const base = data.base || false\r\n\r\n      if (options && typeof options === 'object' && Object.keys(options).length > 0) {\r\n        if (base) {\r\n          const checkbase = options[base] !== 'undefined' ? options[base] : (options[base] = null)\r\n\r\n          if (checkbase) {\r\n            return typeof options[base][name] !== 'undefined' ? options[base][name] : (options[base][name] = defaultvalue)\r\n          } else {\r\n            return defaultvalue\r\n          }\r\n        } else {\r\n          return typeof options[name] !== 'undefined' ? options[name] : (options[name] = defaultvalue)\r\n        }\r\n      } else {\r\n        return defaultvalue\r\n      }\r\n    }\r\n\r\n    suchdb.options = {\r\n      master: getoption({ name: 'master', base: false }, nodeify('suchdb_data', 'data')),\r\n      autosave: getoption({ name: 'autosave', base: false }, nodeify(false, true)),\r\n      autoload: getoption({ name: 'autoload', base: false }, false),\r\n      encrypt: {\r\n        enabled: getoption({ name: 'enabled', base: 'encrypt' }, nodeify(false, true)),\r\n        key: getoption({ name: 'key', base: 'encrypt' }, nodeify('SuchDB', 'SuchDB_Key'))\r\n      },\r\n      autobackup: getoption({ name: 'autobackup', base: false }, false),\r\n      logging: getoption({ name: 'logging', base: false }, false),\r\n      logging_custom: getoption({ name: 'logging_custom', base: false }, () => { })\r\n    }\r\n\r\n    suchdb.isNode = isNode || false\r\n\r\n    suchdb.generateSID = (length) => Math.random().toString(36).substring(2, ((length || 8) + 2)) // SID = Simple ID\r\n\r\n    if (suchdb.isNode) {\r\n      suchdb.nodeDriver = {\r\n        fs: require('fs')\r\n      }\r\n    }\r\n\r\n    let store = {}\r\n\r\n    const SuchDBEncryption = {\r\n      encrypt: function (content, key) {\r\n        const result = []\r\n        const keyLen = key.length\r\n        for (let i = 0; i < content.length; i++) {\r\n          const keyOffset = i % keyLen\r\n          const calAscii = (content.charCodeAt(i) + key.charCodeAt(keyOffset))\r\n          result.push(calAscii)\r\n        }\r\n        return JSON.stringify(result)\r\n      },\r\n\r\n      decrypt: function (content, key) {\r\n        const result = []\r\n        let str = ''\r\n        const codesArr = JSON.parse(content)\r\n        const keyLen = key.length\r\n        for (var i = 0; i < codesArr.length; i++) {\r\n          const keyOffset = i % keyLen\r\n          const calAscii = (codesArr[i] - key.charCodeAt(keyOffset))\r\n          result.push(calAscii)\r\n        }\r\n        for (var i = 0; i < result.length; i++) {\r\n          const ch = String.fromCharCode(result[i]); str += ch\r\n        }\r\n        return str\r\n      }\r\n    }\r\n\r\n    function __removeEvent (id) {\r\n      try {\r\n        events = events.filter((element) => `${element.id}` !== `${id}`)\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __emit (event) {\r\n      try {\r\n        events.forEach(function (data) {\r\n          if (data.event === event) {\r\n            try {\r\n              event.callback()\r\n            } catch (error) {\r\n              console.log(error)\r\n            }\r\n\r\n            if (data.once) {\r\n              __removeEvent(data.id)\r\n            }\r\n          }\r\n        })\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __log (message) {\r\n      try {\r\n        if (suchdb.options.logging) {\r\n          if (suchdb.options.logging_custom != false) {\r\n            suchdb.options.logging_custom(message)\r\n          } else {\r\n            console.log(`[SuchDB ${version} at ${new Date().toTimeString()}] ${message}`)\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __backup (dataToBackup) {\r\n      try {\r\n        if (suchdb.options.autobackup) {\r\n          dataToBackup = dataToBackup || JSON.stringify({ error: 'SuchDB Data Backup Error!' })\r\n\r\n          if (suchdb.isNode) {\r\n            suchdb.nodeDriver.fs.writeFileSync(`${suchdb.options.master}.backup.suchdb`, dataToBackup)\r\n          } else {\r\n            localStorage.setItem(`backup_${suchdb.options.master}`, JSON.stringify(dataToBackup))\r\n          }\r\n        }\r\n        __log('Successfully backed up!')\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __loadBackup (overwrite) {\r\n      try {\r\n        if (suchdb.options.autobackup) {\r\n          overwrite = overwrite || false\r\n\r\n          let dataFromBackup = ''\r\n\r\n          if (suchdb.isNode) {\r\n            dataFromBackup = suchdb.nodeDriver.fs.readFileSync(`${suchdb.options.master}.backup.suchdb`) || ''\r\n          } else {\r\n            dataFromBackup = localStorage.getItem(`backup_${suchdb.options.master}`) || ''\r\n          }\r\n\r\n          if (suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n            dataFromBackup = SuchDBEncryption.decrypt(dataFromBackup, suchdb.options.encrypt.key)\r\n          }\r\n\r\n          if (overwrite) {\r\n            store = JSON.parse(dataFromBackup)\r\n          } else {\r\n            store = Object.assign(store, JSON.parse(dataFromBackup))\r\n          }\r\n        }\r\n        __log('Successfully loaded a backup of the database!')\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __snapshot (options) {\r\n      const config = {\r\n        master: options.master || `snapshot_${suchdb.options.master || 'suchdb'}`,\r\n        decrypt: options.decrypt || false,\r\n        id: options.id || suchdb.generateSID(48)\r\n      }\r\n\r\n      try {\r\n        let snapshotData = store || { error: 'SuchDB Data Snapshot Error!' }\r\n\r\n        snapshotData.id = config.id || null\r\n\r\n        snapshotData = JSON.stringify(snapshotData) || ''\r\n\r\n        if (!config.decrypt && suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n          snapshotData = SuchDBEncryption.encrypt(snapshotData, suchdb.options.encrypt.key)\r\n        }\r\n\r\n        if (suchdb.isNode) {\r\n          suchdb.nodeDriver.fs.writeFileSync(`${config.master}.snapshot.suchdb`, snapshotData)\r\n        } else {\r\n          localStorage.setItem(`snapshot_${config.master}`, JSON.stringify(snapshotData))\r\n        }\r\n        __log('Successfully created snapshot!')\r\n      } catch (error) {\r\n        console.log(error)\r\n        __emit('error', error)\r\n      }\r\n    }\r\n\r\n    function __loadSnapshot (options, overwrite) {\r\n      const config = {\r\n        master: options.master || `snapshot_${suchdb.options.master || 'suchdb'}`,\r\n        decrypt: options.decrypt || false,\r\n        id: options.id || suchdb.generateSID(48)\r\n      }\r\n\r\n      try {\r\n        overwrite = overwrite || false\r\n\r\n        let snapshotData = ''\r\n\r\n        if (suchdb.isNode) {\r\n          snapshotData = suchdb.nodeDriver.fs.readFileSync(`${config.master}.snapshot.suchdb`) || ''\r\n        } else {\r\n          snapshotData = localStorage.getItem(`snapshot_${config.master}`) || ''\r\n        }\r\n\r\n        if (config.decrypt && suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n          snapshotData = SuchDBEncryption.decrypt(snapshotData, suchdb.options.encrypt.key)\r\n        }\r\n\r\n        if (overwrite) {\r\n          store = JSON.parse(snapshotData)\r\n        } else {\r\n          store = Object.assign(store, JSON.parse(snapshotData))\r\n        }\r\n      } catch (error) {\r\n        console.log(error)\r\n        __emit('error', error)\r\n      }\r\n    }\r\n\r\n    function __save () {\r\n      try {\r\n        let dataToSave = store || JSON.stringify({ error: 'SuchDB Data Save Error!' })\r\n\r\n        if (suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n          dataToSave = SuchDBEncryption.encrypt(JSON.stringify(dataToSave), suchdb.options.encrypt.key)\r\n        }\r\n\r\n        if (suchdb.isNode) {\r\n          suchdb.nodeDriver.fs.writeFileSync(`${suchdb.options.master}.suchdb`, dataToSave)\r\n        } else {\r\n          localStorage.setItem(suchdb.options.master, JSON.stringify(dataToSave))\r\n        }\r\n\r\n        __log('Successfully saved the database!')\r\n\r\n        __backup(dataToSave)\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function __load (overwrite) {\r\n      try {\r\n        overwrite = overwrite || false\r\n\r\n        let dataToLoad = ''\r\n\r\n        if (suchdb.isNode) {\r\n          dataToLoad = suchdb.nodeDriver.fs.readFileSync(`${suchdb.options.master}.suchdb`) || ''\r\n\r\n          if (suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n            dataToLoad = SuchDBEncryption.decrypt(dataToLoad, suchdb.options.encrypt.key)\r\n          }\r\n\r\n          if (overwrite) {\r\n            store = JSON.parse(dataToLoad)\r\n          } else {\r\n            store = Object.assign(store, JSON.parse(dataToLoad))\r\n          }\r\n        } else {\r\n          dataToLoad = localStorage.getItem(suchdb.options.master) || ''\r\n\r\n          if (suchdb.options.encrypt.enabled && typeof suchdb.options.encrypt.key === 'string') {\r\n            dataToLoad = SuchDBEncryption.decrypt(dataToLoad, suchdb.options.encrypt.key)\r\n          }\r\n\r\n          if (overwrite) {\r\n            store = JSON.parse(dataToLoad)\r\n          } else {\r\n            store = Object.assign(store, JSON.parse(dataToLoad))\r\n          }\r\n        }\r\n\r\n        __log('Successfully loaded the database!')\r\n\r\n        _save()\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n\r\n    function _save () {\r\n      if (suchdb.options.autosave) {\r\n        __save()\r\n      }\r\n    }\r\n\r\n    function Init () {\r\n      __log('Initializing...')\r\n      __emit('init')\r\n      if (suchdb.options.autoload) {\r\n        __load(true)\r\n      }\r\n      suchdb.set('SuchDB_Version', version)\r\n      __emit('ready')\r\n      __log('Initialized!')\r\n    }\r\n\r\n    // Base Functions:\r\n\r\n    /**\r\n    * Set/Add Data To The Database\r\n    *\r\n    * @param {string} key\r\n    * @param {any} value\r\n    */\r\n\r\n    suchdb.set = function (key, value) {\r\n      if (typeof key === 'string' && value) {\r\n        store[key] = JSON.stringify(value)\r\n        __log(`Updated ${key} with ${value}`)\r\n        __emit('set')\r\n      }\r\n      _save()\r\n    }\r\n\r\n    /**\r\n    * Get/Grab Data From The Database\r\n    *\r\n    * @param {string} key\r\n    */\r\n\r\n    suchdb.get = function (key) {\r\n      if (typeof key === 'string') {\r\n        const getdata = typeof store[key] !== 'undefined' ? store[key] : (store[key] = JSON.stringify('ERROR, Date Not Found!'))\r\n        __log(`Fetching ${key}...`)\r\n        __emit('get')\r\n        return JSON.parse(getdata) || { error: 'Data Fetch Failed!' }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Remove/Delete Data From The Database\r\n    *\r\n    * @param {string} key\r\n    */\r\n\r\n    suchdb.remove = function (key) {\r\n      if (typeof key === 'string') {\r\n        delete store[key]\r\n        __log(`Removed ${key}.`)\r\n        __emit('remove')\r\n      }\r\n      _save()\r\n    }\r\n\r\n    /**\r\n    * Clear/Delete All Data In The Database\r\n    */\r\n\r\n    suchdb.clear = function () {\r\n      store = {}\r\n      __log(`Cleared ${key}.`)\r\n      __emit('clear')\r\n      _save()\r\n    }\r\n\r\n    /**\r\n    * Get Database Keys\r\n    */\r\n\r\n    suchdb.keys = function () {\r\n      __log('Fetching keys...')\r\n      __emit('keys')\r\n      return Object.keys(store)\r\n    }\r\n\r\n    /**\r\n    * Get Database Values\r\n    */\r\n\r\n    suchdb.values = function () {\r\n      __log('Fetching values...')\r\n      __emit('values')\r\n      return Object.values(store)\r\n    }\r\n\r\n    /**\r\n    * Get Database Entries\r\n    */\r\n\r\n    suchdb.entries = function () {\r\n      __log('Fetching entries...')\r\n      __emit('entries')\r\n      return Object.entries(store)\r\n    }\r\n\r\n    /**\r\n    * Loop Through All Data In The Database\r\n    *\r\n    * @param {function} callback(key, value)\r\n    */\r\n\r\n    suchdb.forEach = function (callback) {\r\n      __log('Looping through the database...')\r\n      __emit('foreach')\r\n      for (const key in store) {\r\n        if (store.hasOwnProperty(key)) {\r\n          callback(key, store[key])\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n    * Get Database Size\r\n    */\r\n\r\n    suchdb.size = function () {\r\n      __log(`The database size is ${Object.keys(store).length}`)\r\n      __emit('size')\r\n      return Object.keys(store).length\r\n    }\r\n\r\n    /**\r\n    * Check If Database Is Empty\r\n    */\r\n\r\n    suchdb.isEmpty = function () {\r\n      __log(`The database is empty: ${Object.keys(store).length == 0}`)\r\n      __emit('isempty')\r\n      return Object.keys(store).length == 0\r\n    }\r\n\r\n    /**\r\n    * Check If Database Has Data\r\n    */\r\n\r\n    suchdb.has = function (key) {\r\n      __log(`The database has data: ${Object.hasOwnProperty(store, key)}`)\r\n      __emit('has')\r\n      return Object.hasOwnProperty(store, key)\r\n    }\r\n\r\n    /**\r\n    * Lookup Data In The Database\r\n    *\r\n    * @param {any} value\r\n    */\r\n\r\n    suchdb.lookup = function (value) {\r\n      __log(`Looking up ${value}...`)\r\n      __emit('lookup')\r\n      return Object.values(store).includes(value)\r\n    }\r\n\r\n    /**\r\n    * Sort the database\r\n    *\r\n    * @param {string} key\r\n    * @param {boolean} reverse\r\n    */\r\n\r\n    suchdb.sort = function (key, reverse) {\r\n      __log(`Sorting the database in ${key} and in reverse: ${reverse}`)\r\n      __emit('sort')\r\n      store = store.sort(function (such, db) {\r\n        if (key) {\r\n          if (reverse) {\r\n            return such[key] - db[key]\r\n          } else {\r\n            return db[key] - such[key]\r\n          }\r\n        } else {\r\n          if (reverse) {\r\n            return such - db\r\n          } else {\r\n            return db - such\r\n          }\r\n        }\r\n      })\r\n      _save()\r\n    }\r\n\r\n    /**\r\n    * Find An Entry\r\n    * @param {any} query\r\n    */\r\n\r\n    suchdb.find = function (query = { name: '', value: '' }) {\r\n      __log(`Finding an entry in the database with the query of ${query}`)\r\n      __emit('find')\r\n      suchdb.forEach((key, value) => {\r\n        if (key[query.name] === query.value) {\r\n          __log(`Found ${{ key, value }}`)\r\n          return { key, value }\r\n        }\r\n      })\r\n\r\n      return null\r\n    }\r\n\r\n    suchdb.findMultiple = function (query = { name: '', value: '' }) {\r\n      __log(`Finding multiple entries in the database with the query of ${query}`)\r\n      __emit('findmultiple')\r\n      const results = []\r\n      suchdb.forEach((key, value) => {\r\n        if (key[query.name] === query.value) {\r\n          __log(`Found ${{ key, value }}`)\r\n          results.push({ key, value })\r\n        }\r\n      })\r\n\r\n      __log(`Results: ${results}`)\r\n\r\n      return results\r\n    }\r\n\r\n    /**\r\n    * Port Json To The Database\r\n    * @param {any} json\r\n    * @param {boolean} overwrite\r\n    */\r\n\r\n    suchdb.port = function (json, overwrite) {\r\n      __log(`Porting database with ${json} ovewrite: ${overwrite}`)\r\n      __emit('port')\r\n      if (overwrite) {\r\n        store = JSON.parse(json)\r\n      } else {\r\n        store = Object.assign(store, JSON.parse(json))\r\n      }\r\n      _save()\r\n    }\r\n\r\n    /**\r\n    * Save Database To:\r\n    * > localStorage\r\n    * > node-fs\r\n    */\r\n\r\n    suchdb.save = function () {\r\n      __log('Saving the database...')\r\n      __emit('save')\r\n      __save()\r\n    }\r\n\r\n    /**\r\n    * Load Database From:\r\n    * > localStorage\r\n    * > node-fs\r\n    */\r\n\r\n    suchdb.load = function (overwrite) {\r\n      __log('Loading the database...')\r\n      __emit('load')\r\n      __load(overwrite)\r\n    }\r\n\r\n    /**\r\n    * Backup Database To:\r\n    * > localStorage\r\n    * > node-fs\r\n    */\r\n\r\n    suchdb.saveBackup = function () {\r\n      __log('Saving a backup of the database...')\r\n      __emit('savebackup')\r\n      __backup(store)\r\n    }\r\n\r\n    /**\r\n    * Backup Database From:\r\n    * > localStorage\r\n    * > node-fs\r\n    */\r\n\r\n    suchdb.loadBackup = function (overwrite) {\r\n      __log(`Loading a backup of the database overwrite: ${overwrite}`)\r\n      __emit('loadbackup')\r\n      __loadBackup(overwrite)\r\n    }\r\n\r\n    /**\r\n    * Create an snapshot of the database\r\n    * @param {object} options\r\n    */\r\n\r\n    suchdb.snapshot = function (options) {\r\n      __log('Creating a snapshot of the database...')\r\n      __emit('snapshot')\r\n      __snapshot(options)\r\n    }\r\n\r\n    /**\r\n    * Load an snapshot to the database\r\n    * @param {object} options\r\n    * @param {boolean} override\r\n    */\r\n\r\n    suchdb.loadSnapshot = function (options, override) {\r\n      __log('Loading a snapshot to the database...')\r\n      __emit('loadsnapshot')\r\n      __loadSnapshot(options, override)\r\n    }\r\n\r\n    /**\r\n    * Get Raw Database Data\r\n    */\r\n\r\n    suchdb.raw = function () {\r\n      __log('Getting the database in a raw format (No encryption)')\r\n      __emit('raw')\r\n      return store || {}\r\n    }\r\n\r\n    /**\r\n    * Get A List Of Database Events\r\n    */\r\n\r\n    suchdb.getEvents = function () {\r\n      __log('Fetching a list of events...')\r\n\r\n      const eventList = []\r\n      const suchdbKeys = Object.keys(suchdb) || {}\r\n\r\n      suchdbKeys.forEach(function (key) {\r\n        const eventName = `${key}`.toLowerCase()\r\n\r\n        eventList.push(eventName)\r\n      })\r\n    }\r\n\r\n    /**\r\n    * Get Database Events\r\n    */\r\n\r\n    suchdb.events = events\r\n\r\n    /**\r\n    * Create an new on event listener\r\n    */\r\n\r\n    suchdb.on = function (event, callback) {\r\n      const id = new Date().valueOf()\r\n\r\n      __log(`New on listener: ${id}`)\r\n\r\n      events.push({ event: `${event}`, id: `${id}`, callback, once: false })\r\n\r\n      return id\r\n    }\r\n\r\n    /**\r\n    * Create an new once event listener\r\n    */\r\n\r\n    suchdb.once = function (event, callback) {\r\n      const id = new Date().valueOf()\r\n\r\n      __log(`New once listener: ${id}`)\r\n\r\n      events.push({ event: `${event}`, id: `${id}`, callback, once: true })\r\n\r\n      return id\r\n    }\r\n\r\n    /**\r\n    * Delete an on/once event listener\r\n    */\r\n\r\n    suchdb.off = function (id) {\r\n      __log(`Removed listener: ${id}`)\r\n      __removeEvent(`${id}`)\r\n    }\r\n\r\n    // Main Functions:\r\n\r\n    Init()\r\n\r\n    return suchdb || null\r\n  }\r\n\r\n  /**\r\n  * SuchDB\r\n  *\r\n  * @param {Object} options\r\n  */\r\n\r\n  function Boot (options) {\r\n    let isNode = false\r\n\r\n    if (typeof window === 'undefined') {\r\n      isNode = true\r\n    }\r\n\r\n    return SuchDBMaster(options, isNode)\r\n  }\r\n\r\n  var exports = exports || {}\r\n  var module = module || {}\r\n\r\n  exports.SuchDB = function SuchDB (options) {\r\n    return Boot(options)\r\n  }\r\n\r\n  module.exports = {\r\n    SuchDB: Boot\r\n  }\r\n})(typeof exports === 'undefined' ? this.SuchDB = {} : exports)\r\n\r\n// SuchDB, Auhtor: Sectly (Sectly@sectly.online) | MPL-2.0 Licence.\r\n"],"names":["exports","Boot","options","isNode","window","version","suchdb","events","nodeify","defaultvalue","nodevalue","getoption","data","name","base","Object","keys","length","master","autosave","autoload","encrypt","enabled","key","autobackup","logging","logging_custom","generateSID","Math","random","toString","substring","nodeDriver","fs","require","store","SuchDBEncryption","content","result","keyLen","i","keyOffset","calAscii","charCodeAt","push","JSON","stringify","decrypt","str","codesArr","parse","String","fromCharCode","__removeEvent","id","filter","element","error","console","log","__emit","event","forEach","callback","once","__log","message","Date","toTimeString","__backup","dataToBackup","writeFileSync","localStorage","setItem","__save","dataToSave","__load","overwrite","dataToLoad","readFileSync","assign","getItem","_save","set","value","get","getdata","remove","clear","values","entries","hasOwnProperty","size","isEmpty","has","lookup","includes","sort","reverse","such","db","find","query","findMultiple","results","port","json","save","load","saveBackup","loadBackup","dataFromBackup","__loadBackup","snapshot","config","snapshotData","__snapshot","loadSnapshot","override","__loadSnapshot","raw","getEvents","on","valueOf","off","SuchDBMaster","module","SuchDB","this"],"mappings":"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"}